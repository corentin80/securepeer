<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”’ SecurePeer - Transfert SÃ©curisÃ©</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="top-header">
        <div class="header-content">
            <div class="header-logo">
                <span class="logo-icon">ğŸ”’</span>
                <span class="logo-text">SecurePeer</span>
                <span class="ephemeral-badge hidden" id="ephemeral-badge" title="Cette session est temporaire et sera dÃ©truite aprÃ¨s utilisation">â±ï¸ Session Ã©phÃ©mÃ¨re</span>
            </div>
            <div class="header-actions">
                <button id="theme-toggle" class="theme-toggle" title="Changer de thÃ¨me">ğŸŒ“</button>
                <div class="language-selector">
                    <button id="language-toggle" class="language-toggle" title="Select language">ğŸŒ FR</button>
                    <div id="language-menu" class="language-menu hidden">
                        <button data-lang="fr" class="lang-option">ğŸ‡«ğŸ‡· FranÃ§ais</button>
                        <button data-lang="en" class="lang-option">ğŸ‡¬ğŸ‡§ English</button>
                        <button data-lang="es" class="lang-option">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
                        <button data-lang="it" class="lang-option">ğŸ‡®ğŸ‡¹ Italiano</button>
                        <button data-lang="ru" class="lang-option">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- LANDING PAGE / PAGE DE PRÃ‰SENTATION -->
        <section id="landing-page" class="section landing-page">
            <div class="hero-landing">
                <div class="hero-icon">ğŸ”’</div>
                <h1>SecurePeer</h1>
                <p class="hero-tagline">Transfert de fichiers & chat chiffrÃ© de bout en bout</p>
                <p class="hero-description">Partagez des fichiers et communiquez en toute sÃ©curitÃ©, directement entre appareils, sans aucun serveur intermÃ©diaire.</p>
            </div>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”</div>
                    <h3>Chiffrement AES-256</h3>
                    <p>Vos donnÃ©es sont chiffrÃ©es de bout en bout avec un algorithme de qualitÃ© militaire.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸŒ</div>
                    <h3>Connexion P2P</h3>
                    <p>Transfert direct via WebRTC. Aucun fichier ne transite par nos serveurs.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ‘¥</div>
                    <h3>Jusqu'Ã  20 personnes</h3>
                    <p>CrÃ©ez des rooms de groupe pour partager avec plusieurs personnes simultanÃ©ment.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸš«</div>
                    <h3>Aucun stockage</h3>
                    <p>Nous ne stockons rien. Pas de compte, pas de logs, pas de traces.</p>
                </div>
            </div>
            
            <div class="cta-section">
                <button id="start-session-btn" class="btn btn-primary btn-xlarge">ğŸš€ Commencer</button>
                <p class="cta-hint">Gratuit, sans inscription</p>
            </div>
            
            <div class="how-it-works">
                <h2>Comment Ã§a marche ?</h2>
                <div class="steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h4>CrÃ©ez une session</h4>
                        <p>Choisissez le mode : fichiers, chat ou les deux</p>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <h4>Partagez le lien</h4>
                        <p>Envoyez le lien sÃ©curisÃ© Ã  vos destinataires</p>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <h4>TransfÃ©rez</h4>
                        <p>Ã‰changez fichiers et messages en toute sÃ©curitÃ©</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SÃ‰LECTION DU PSEUDO (affichÃ© avant crÃ©ation/jointure) -->
        <section id="pseudo-section" class="section pseudo-section hidden">
            <div>
                <div class="pseudo-header">
                    <h2>ğŸ‘¤ Choisissez un pseudo</h2>
                    <p class="section-desc">Ce pseudo sera visible par les autres participants</p>
                </div>
                <div class="pseudo-form">
                    <input type="text" id="pseudo-input-main" placeholder="Votre pseudo" maxlength="20" class="pseudo-input" autofocus>
                    <p class="hint">âœ¨ 3 Ã  20 caractÃ¨res</p>
                    <button id="pseudo-confirm-btn" class="btn btn-primary btn-large">Continuer</button>
                </div>
            </div>
        </section>

        <!-- SÃ‰LECTION DU MODE -->
        <section id="mode-selection" class="section mode-selection hidden">
            <div class="mode-header">
                <h2>ğŸš€ CrÃ©er une session</h2>
                <p class="section-desc">Choisissez le type de session que vous souhaitez dÃ©marrer</p>
            </div>
            <div class="mode-cards">
                <button class="mode-card" data-mode="file">
                    <div class="mode-icon">ğŸ“</div>
                    <h3>Transfert de fichiers</h3>
                    <p>Envoyez des fichiers de maniÃ¨re sÃ©curisÃ©e</p>
                </button>
                <button class="mode-card" data-mode="chat">
                    <div class="mode-icon">ğŸ’¬</div>
                    <h3>Chat sÃ©curisÃ©</h3>
                    <p>Discutez en temps rÃ©el, chiffrÃ© E2E</p>
                </button>
                <button class="mode-card" data-mode="both">
                    <div class="mode-icon">ğŸ“ğŸ’¬</div>
                    <h3>Fichiers + Chat</h3>
                    <p>TransfÃ©rez et discutez simultanÃ©ment</p>
                </button>
            </div>
        </section>

        <!-- MODE EXPÃ‰DITEUR (par dÃ©faut) -->
        <section id="sender-section" class="section sender-section hidden">
            <div class="sender-header">
                <h2>ğŸ“¤ Envoyer un fichier</h2>
                <p class="section-desc">Choisissez un fichier et partagez le lien sÃ©curisÃ©</p>
            </div>

            <div id="drop-zone" class="drop-zone">
                <div class="drop-zone-content">
                    <span class="drop-icon">ğŸ“</span>
                    <p><strong>Glissez-dÃ©posez un fichier ici</strong></p>
                    <p class="or">ou cliquez pour sÃ©lectionner</p>
                    <label class="file-input-label">
                        <input type="file" id="file-input" hidden multiple>
                        <span class="btn btn-primary btn-large">Choisir un fichier</span>
                    </label>
                </div>
            </div>

            <!-- Infos fichier sÃ©lectionnÃ© -->
            <div id="file-info" class="file-info hidden">
                <div class="file-icon">ğŸ“„</div>
                <div class="file-details">
                    <span id="file-name" class="file-name"></span>
                    <span id="file-size" class="file-size"></span>
                </div>
                <button id="clear-file" class="btn btn-small">âœ• Supprimer</button>
            </div>

            <!-- Mot de passe (optionnel) -->
            <div class="password-block hidden" id="password-block">
                <label for="password-input">ğŸ” Protection par mot de passe (optionnel)</label>
                <input type="password" id="password-input" placeholder="Entrez un mot de passe pour plus de sÃ©curitÃ©">
                <p class="hint">Le mot de passe ne quitte jamais votre appareil</p>
                
                <!-- Options de sÃ©curitÃ© avancÃ©es -->
                <div class="security-options">
                    <h4>âš™ï¸ Options de sÃ©curitÃ©</h4>
                    
                    <div class="option-group">
                        <label for="session-expiration">â±ï¸ Expiration de la session</label>
                        <select id="session-expiration">
                            <option value="0">IllimitÃ©</option>
                            <option value="15">15 minutes</option>
                            <option value="60">1 heure</option>
                            <option value="1440">24 heures</option>
                            <option value="10080">7 jours</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <label for="max-participants">ğŸ‘¥ Limite de participants</label>
                        <select id="max-participants">
                            <option value="1">1 (privÃ©)</option>
                            <option value="2">2</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="20" selected>20 (max)</option>
                        </select>
                    </div>
                    
                    <div class="option-group option-toggle">
                        <label for="require-approval">
                            <input type="checkbox" id="require-approval">
                            âœ‹ Approbation des participants
                        </label>
                        <p class="hint">Vous devrez accepter chaque nouveau membre</p>
                    </div>
                    
                    <div class="option-group option-toggle">
                        <label for="auto-lock">
                            <input type="checkbox" id="auto-lock">
                            ğŸ”’ Verrouillage automatique
                        </label>
                        <p class="hint">Verrouiller la session dÃ¨s qu'un participant rejoint</p>
                    </div>
                </div>
                
                <button id="send-file-btn" class="btn btn-primary btn-large">ğŸ“¤ Envoyer le fichier</button>
            </div>

            <!-- Zone de lien Ã  partager -->
            <div id="link-section" class="link-section hidden">
                <div class="link-header">
                    <h3>ğŸ”— Lien de partage gÃ©nÃ©rÃ©</h3>
                    <p class="link-info">Partagez ce lien avec le destinataire</p>
                </div>
                <div class="security-warning">
                    <span class="warning-icon">âš ï¸</span>
                    <p><strong>Attention :</strong> Ce lien identifie votre session. Ne le partagez qu'avec les destinataires prÃ©vus.</p>
                </div>
                <div class="link-container">
                    <input type="text" id="share-link" readonly class="share-link-input">
                    <button id="copy-link" class="btn btn-primary">ğŸ“‹ Copier</button>
                </div>
                <div id="qrcode-container" class="qrcode-container hidden">
                    <div id="qrcode"></div>
                    <p class="qrcode-hint">Scannez pour recevoir sur mobile</p>
                </div>
                <p id="link-status" class="status status-waiting">
                    <span class="pulse"></span>
                    En attente du destinataire...
                </p>
                
                <!-- Dropdown pour les pseudos connectÃ©s -->
                <div class="connected-users-section hidden" id="connected-users-section">
                    <label for="connected-users-dropdown">ğŸ‘¥</label>
                    <select id="connected-users-dropdown" class="connected-users-dropdown">
                        <option disabled selected>ConnectÃ©s</option>
                    </select>
                </div>
                
                <!-- ContrÃ´les de session -->
                <div class="session-controls" style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="lock-session-btn" class="btn btn-secondary lock-session-btn" title="Bloquer les nouveaux participants">ğŸ”’ Verrouiller</button>
                    <button id="close-session" class="btn btn-primary">ğŸšª Fermer</button>
                </div>
            </div>

            <!-- Zone de Chat (visible si mode chat ou both) -->
            <div id="chat-section" class="chat-section hidden">
                <div class="chat-header">
                    <h3>ğŸ’¬ Chat sÃ©curisÃ©</h3>
                    <span class="chat-status" id="chat-status">En attente...</span>
                    <div class="chat-tools">
                        <button class="chat-tool-btn" id="chat-search-toggle" title="Rechercher">ğŸ”</button>
                        <button class="chat-tool-btn" id="chat-pins-toggle" title="Messages Ã©pinglÃ©s">ğŸ“Œ</button>
                        <button class="chat-tool-btn" id="chat-export-btn" title="Exporter la conversation">ğŸ“¥</button>
                        <button class="chat-tool-btn" id="chat-ephemeral-toggle" title="Messages Ã©phÃ©mÃ¨res">â±ï¸</button>
                    </div>
                </div>
                <!-- Barre de recherche -->
                <div class="chat-search-bar hidden" id="chat-search-bar">
                    <input type="text" id="chat-search-input" placeholder="Rechercher un message...">
                    <select id="chat-search-user-filter">
                        <option value="">Tous les utilisateurs</option>
                    </select>
                    <button class="btn btn-small" id="chat-search-clear">âœ•</button>
                    <span class="search-results-count" id="chat-search-count"></span>
                </div>
                <!-- Messages Ã©pinglÃ©s -->
                <div class="chat-pinned-section hidden" id="chat-pinned-section">
                    <div class="pinned-header">ğŸ“Œ Messages Ã©pinglÃ©s</div>
                    <div class="pinned-messages-list" id="chat-pinned-list"></div>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <!-- Messages dynamiques -->
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chat-input" placeholder="Tapez votre message..." autocomplete="off">
                    <button id="chat-send" class="btn btn-primary">Envoyer</button>
                </div>
                <button id="close-chat-session" class="btn btn-primary" style="margin-top: 15px; width: 100%;">ğŸšª Fermer la session</button>
            </div>
            
            <!-- Zone de fichiers pour mode both (cÃ´tÃ© expÃ©diteur) -->
            <div id="both-file-section" class="both-file-section hidden">
                <div class="both-file-header">
                    <h4>ğŸ“ Fichiers</h4>
                </div>
                <div id="both-file-list" class="both-file-list">
                    <!-- Liste des fichiers reÃ§us/envoyÃ©s -->
                </div>
                <div class="both-file-input">
                    <label class="btn btn-small btn-file-select">
                        <input type="file" id="both-file-input" hidden multiple>
                        ğŸ“ Ajouter
                    </label>
                    <button id="both-file-send" class="btn btn-primary btn-small" disabled>ğŸ“¤ Envoyer</button>
                </div>
            </div>
        </section>

        <!-- MODE DESTINATAIRE -->
        <section id="receiver-section" class="section hidden">
            <div class="receiver-info">
                <h2 id="receiver-title">ğŸ“¥ RÃ©ception de fichier</h2>

                <div id="receiver-password-block" class="password-block hidden">
                    <label for="receiver-password">Mot de passe requis</label>
                    <input type="password" id="receiver-password" placeholder="Entrez le mot de passe partagÃ©">
                    <button id="receiver-password-apply" class="btn btn-primary">DÃ©verrouiller</button>
                    <p class="hint">Le mot de passe reste sur cet appareil et dÃ©rive la clÃ© de chiffrement.</p>
                </div>

                <div id="incoming-file-info" class="incoming-file-info">
                    <div class="file-icon large">ğŸ“„</div>
                    <p id="incoming-file-name" class="file-name"></p>
                    <p id="incoming-file-size" class="file-size"></p>
                </div>
                <button id="receive-file-btn" class="btn btn-primary hidden">ğŸ“¥ Recevoir le fichier</button>
                <p id="receiver-status" class="status">Connexion en cours...</p>
            </div>

            <!-- Zone de Chat cÃ´tÃ© destinataire -->
            <div id="receiver-chat-section" class="chat-section hidden">
                <div class="chat-header">
                    <h3>ğŸ’¬ Chat sÃ©curisÃ©</h3>
                    <span class="chat-status" id="receiver-chat-status">ConnectÃ©</span>
                    <div class="chat-tools">
                        <button class="chat-tool-btn" id="receiver-chat-search-toggle" title="Rechercher">ğŸ”</button>
                        <button class="chat-tool-btn" id="receiver-chat-pins-toggle" title="Messages Ã©pinglÃ©s">ğŸ“Œ</button>
                        <button class="chat-tool-btn" id="receiver-chat-export-btn" title="Exporter la conversation">ğŸ“¥</button>
                        <button class="chat-tool-btn" id="receiver-chat-ephemeral-toggle" title="Messages Ã©phÃ©mÃ¨res">â±ï¸</button>
                    </div>
                    <!-- Dropdown pour les pseudos connectÃ©s (receiver) - dans le header -->
                    <div class="connected-users-section hidden" id="receiver-connected-users-section">
                        <label for="receiver-connected-users-dropdown">ğŸ‘¥</label>
                        <select id="receiver-connected-users-dropdown" class="connected-users-dropdown">
                            <option disabled selected>ConnectÃ©s</option>
                        </select>
                    </div>
                </div>
                <!-- Barre de recherche -->
                <div class="chat-search-bar hidden" id="receiver-chat-search-bar">
                    <input type="text" id="receiver-chat-search-input" placeholder="Rechercher un message...">
                    <select id="receiver-chat-search-user-filter">
                        <option value="">Tous les utilisateurs</option>
                    </select>
                    <button class="btn btn-small" id="receiver-chat-search-clear">âœ•</button>
                    <span class="search-results-count" id="receiver-chat-search-count"></span>
                </div>
                <!-- Messages Ã©pinglÃ©s -->
                <div class="chat-pinned-section hidden" id="receiver-chat-pinned-section">
                    <div class="pinned-header">ğŸ“Œ Messages Ã©pinglÃ©s</div>
                    <div class="pinned-messages-list" id="receiver-chat-pinned-list"></div>
                </div>
                <div class="chat-messages" id="receiver-chat-messages">
                    <!-- Messages dynamiques -->
                </div>
                <div class="chat-input-container">
                    <input type="text" id="receiver-chat-input" placeholder="Tapez votre message..." autocomplete="off">
                    <button id="receiver-chat-send" class="btn btn-primary">Envoyer</button>
                </div>
                <button id="close-receiver-session" class="btn btn-primary" style="margin-top: 15px; width: 100%;">ğŸšª Fermer la session</button>
            </div>
            
            <!-- Zone de fichiers pour mode both (cÃ´tÃ© destinataire) -->
            <div id="receiver-both-file-section" class="both-file-section hidden">
                <div class="both-file-header">
                    <h4>ğŸ“ Fichiers</h4>
                </div>
                <div id="receiver-both-file-list" class="both-file-list">
                    <!-- Liste des fichiers reÃ§us/envoyÃ©s -->
                </div>
                <div class="both-file-input">
                    <label class="btn btn-small btn-file-select">
                        <input type="file" id="receiver-both-file-input" hidden multiple>
                        ğŸ“ Ajouter
                    </label>
                    <button id="receiver-both-file-send" class="btn btn-primary btn-small" disabled>ğŸ“¤ Envoyer</button>
                </div>
            </div>
        </section>

        <!-- BARRE DE PROGRESSION (commune) -->
        <section id="progress-section" class="section hidden">
            <h3 id="progress-title">Transfert en cours...</h3>
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <div class="progress-stats">
                    <span id="progress-percent">0%</span>
                    <span id="progress-speed"></span>
                    <span id="progress-transferred"></span>
                </div>
            </div>
        </section>

        <!-- SECTION TERMINÃ‰E -->
        <section id="complete-section" class="section hidden">
            <div class="complete-content">
                <div class="complete-icon">âœ…</div>
                <h2>Transfert terminÃ© !</h2>
                <p id="complete-message"></p>
                <div id="integrity-check" class="integrity-check">
                    <span class="integrity-icon">ğŸ”</span>
                    <span>IntÃ©gritÃ© vÃ©rifiÃ©e (SHA-256)</span>
                </div>
                <button id="new-transfer" class="btn btn-primary">Nouveau transfert</button>
            </div>
        </section>

        <!-- SECTION ERREUR -->
        <section id="error-section" class="section hidden">
            <div class="error-content">
                <div class="error-icon">âŒ</div>
                <h2>Erreur</h2>
                <p id="error-message"></p>
                <button id="retry-transfer" class="btn btn-primary">ğŸ  Retour Ã  l'accueil</button>
            </div>
        </section>

        <footer>
            <p>ğŸ” Chiffrement AES-256-GCM | ğŸŒ WebRTC P2P | ğŸš« Aucune donnÃ©e stockÃ©e sur le serveur</p>
            <p class="footer-links">
                <a href="privacy.html" target="_blank">ConfidentialitÃ©</a> | 
                <a href="security.html" target="_blank">SÃ©curitÃ©</a> | 
                <a href="https://github.com/securepeer" target="_blank">GitHub</a>
            </p>
        </footer>
    </div>

    <!-- Popup Tor Browser pour premiÃ¨re utilisation -->
    <div id="tor-popup" class="tor-popup hidden">
        <div class="tor-popup-content">
            <div class="tor-popup-header">
                <span class="tor-icon">ğŸ§…</span>
                <h3>Maximiser votre anonymat</h3>
            </div>
            <div class="tor-popup-body">
                <p>Pour une protection maximale de votre vie privÃ©e, nous recommandons d'utiliser <strong>Tor Browser</strong>.</p>
                <ul>
                    <li>âœ… Masque votre adresse IP</li>
                    <li>âœ… EmpÃªche le tracking</li>
                    <li>âœ… Protection contre la surveillance</li>
                </ul>
                <p class="tor-hint">SecurePeer utilise dÃ©jÃ  du chiffrement E2E, mais Tor Browser ajoute une couche d'anonymat rÃ©seau.</p>
            </div>
            <div class="tor-popup-actions">
                <button id="tor-dismiss" class="btn btn-secondary">Continuer sans Tor</button>
                <a href="https://www.torproject.org/download/" target="_blank" class="btn btn-primary">TÃ©lÃ©charger Tor Browser</a>
            </div>
            <label class="tor-checkbox">
                <input type="checkbox" id="tor-dont-show">
                <span>Ne plus afficher ce message</span>
            </label>
        </div>
    </div>

    <!-- Simple-peer via CDN -->
    <script src="simplepeer.min.js"></script>
    <!-- JSZip for multi-file automatic zipping -->
    <script src="jszip.min.js"></script>
    <!-- QRCode.js for link sharing -->
    <script src="qrcode.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
