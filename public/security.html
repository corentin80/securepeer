<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture & S√©curit√© - SecurePeer</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .security-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 24px;
        }
        .security-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .security-header h1 {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }
        .security-header .tagline {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        .security-section {
            margin-bottom: 40px;
        }
        .security-section h2 {
            font-size: 1.8rem;
            margin-bottom: 16px;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        .security-section h3 {
            font-size: 1.3rem;
            margin: 24px 0 12px 0;
        }
        .security-section p, .security-section li {
            line-height: 1.7;
            color: var(--text);
            margin-bottom: 12px;
        }
        .security-section ul, .security-section ol {
            margin-left: 24px;
        }
        .info-box {
            background: var(--bg-secondary);
            border-left: 4px solid #34c759;
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .info-box.warning {
            border-left-color: #f59e0b;
        }
        .info-box.danger {
            border-left-color: #ef4444;
        }
        .info-box strong {
            color: var(--primary);
        }
        .code-block {
            background: #1c1c1e;
            color: #f5f5f7;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 16px 0;
        }
        .architecture-diagram {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            text-align: center;
            font-family: monospace;
            line-height: 2;
        }
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg);
        }
        th, td {
            border: 1px solid var(--border);
            padding: 12px;
            text-align: left;
        }
        th {
            background: var(--bg-secondary);
            font-weight: 600;
        }
        .back-link {
            display: inline-block;
            margin-top: 40px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header class="top-header">
        <div class="header-content">
            <div class="header-logo">
                <span class="logo-icon">üîí</span>
                <span class="logo-text">SecurePeer</span>
            </div>
        </div>
    </header>
    
    <div class="security-container">
        <div class="security-header">
            <h1>üõ°Ô∏è Architecture & S√©curit√©</h1>
            <p class="tagline">Documentation technique compl√®te</p>
        </div>

        <div class="info-box">
            <strong>Transparence totale :</strong> Ce document explique en d√©tail comment SecurePeer fonctionne, ce qui est loggu√©, ce qui ne l'est pas, et quelles sont les garanties et limites de s√©curit√©. Notre code source sera bient√¥t open-source sur GitHub.
        </div>

        <!-- ARCHITECTURE -->
        <div class="security-section">
            <h2>1. Architecture technique</h2>
            
            <h3>1.1 Vue d'ensemble</h3>
            <p>SecurePeer utilise une architecture <strong>hybride P2P</strong> :</p>
            <ul>
                <li><strong>Signalisation centralis√©e</strong> : WebSocket pour l'√©change initial des m√©tadonn√©es de connexion (SDP, ICE)</li>
                <li><strong>Transfert de donn√©es d√©centralis√©</strong> : WebRTC peer-to-peer direct entre navigateurs</li>
                <li><strong>TURN fallback</strong> : Serveur TURN auto-h√©berg√© pour les connexions derri√®re NAT strict</li>
            </ul>

            <div class="architecture-diagram">
                [Navigateur A] ‚Üê‚Üí [Serveur WebSocket] ‚Üê‚Üí [Navigateur B]<br>
                &nbsp;&nbsp;&nbsp;&nbsp;‚Üì (signalisation uniquement) ‚Üì<br>
                [Navigateur A] ‚Üê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WebRTC P2P ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚Üí [Navigateur B]<br>
                <em>(fichiers & messages chiffr√©s E2E)</em>
            </div>

            <h3>1.2 Composants serveur</h3>
            <ol>
                <li><strong>Nginx</strong> (reverse proxy)
                    <ul>
                        <li>SSL/TLS termination (Let's Encrypt)</li>
                        <li>Headers de s√©curit√© (HSTS, CSP, X-Frame-Options)</li>
                        <li>Logs d√©sactiv√©s (<code>access_log off</code>)</li>
                    </ul>
                </li>
                <li><strong>Node.js + Express</strong> (serveur WebSocket)
                    <ul>
                        <li>Gestion des rooms (cr√©ation, jointure, signalisation)</li>
                        <li>Relais des messages SDP/ICE entre peers</li>
                        <li>Donn√©es en m√©moire uniquement (pas de base de donn√©es)</li>
                    </ul>
                </li>
                <li><strong>coturn</strong> (serveur TURN/STUN)
                    <ul>
                        <li>Relay UDP/TCP pour NAT traversal</li>
                        <li>Credentials √©ph√©m√®res via <code>static-auth-secret</code></li>
                        <li>Mode <code>no-log</code> strict</li>
                    </ul>
                </li>
            </ol>

            <h3>1.3 Format du lien de partage</h3>
            <p>Le lien contient uniquement l'identifiant de session, jamais les cl√©s de chiffrement :</p>
            <ul>
                <li><strong>Mode ECDH (recommand√©) :</strong> <code>https://securepeer.eu/#roomId_mode_ecdh</code>
                    <ul>
                        <li>Room ID : 16 caract√®res al√©atoires</li>
                        <li>Mode : file / chat / both</li>
                        <li><strong>Cl√© AES-256 : d√©riv√©e localement via ECDH, JAMAIS dans l'URL</strong></li>
                    </ul>
                </li>
                <li><strong>Mode Password :</strong> <code>https://securepeer.eu/#roomId_mode_pwd_salt_iterations</code>
                    <ul>
                        <li>Salt : fourni dans l'URL (pour d√©rivation PBKDF2)</li>
                        <li>Password : saisi localement, jamais transmis</li>
                        <li><strong>Cl√© AES-256 : d√©riv√©e du password, JAMAIS dans l'URL</strong></li>
                    </ul>
                </li>
            </ul>
            <p><strong>Implication :</strong> Le lien peut √™tre partag√© via des canaux non s√©curis√©s (email, SMS, r√©seaux publics) sans r√©v√©ler la cl√© de chiffrement.</p>

            <h3>1.4 Flux de connexion</h3>
            <ol>
                <li>Cr√©ateur g√©n√®re un Room ID al√©atoire (16 caract√®res hexad√©cimaux)</li>
                <li>Cr√©ateur g√©n√®re une paire de cl√©s ECDH (Curve25519)</li>
                <li>Lien de partage cr√©√© : <code>https://securepeer.eu/#roomId_mode_ecdh</code></li>
                <li>Destinataire clique sur le lien, g√©n√®re sa propre paire ECDH</li>
                <li>√âchange de cl√©s publiques via WebSocket s√©curis√© (TLS)</li>
                <li>D√©rivation du secret partag√© (ECDH) ‚Üí cl√© AES-256 (effectu√© localement, c√¥t√© client)</li>
                <li>√âtablissement de la connexion WebRTC (SDP offer/answer, ICE candidates)</li>
                <li>Transfert de donn√©es chiffr√©es directement via DataChannel P2P</li>
            </ol>
        </div>

        <!-- CHIFFREMENT -->
        <div class="security-section">
            <h2>2. Chiffrement et cryptographie</h2>
            
            <h3>2.1 Chiffrement des donn√©es (AES-256-GCM)</h3>
            <div class="code-block">
Algorithm: AES-256-GCM (Galois/Counter Mode)<br>
Key size: 256 bits<br>
IV: 96 bits random per message<br>
Auth tag: 128 bits (integrity + authentication)
            </div>
            <p><strong>Pourquoi AES-256-GCM ?</strong></p>
            <ul>
                <li>Standard industriel (NIST, NSA Suite B)</li>
                <li>AEAD (Authenticated Encryption with Associated Data) : chiffrement + int√©grit√© en un seul pass</li>
                <li>R√©sistant aux attaques par timing et padding oracle</li>
                <li>Support mat√©riel (AES-NI) pour performances optimales</li>
            </ul>

            <h3>2.2 √âchange de cl√©s (ECDH)</h3>
            <div class="code-block">
Curve: X25519 (Curve25519 pour ECDH)<br>
Key derivation: HKDF-SHA256<br>
Public key exchange: Via WebSocket (signalisation)
            </div>
            <p><strong>Avantages d'ECDH :</strong></p>
            <ul>
                <li>Cl√© de chiffrement jamais transmise (d√©riv√©e localement des deux c√¥t√©s)</li>
                <li>R√©sistant aux attaques quantiques futures (avec migration vers post-quantum crypto pr√©vue)</li>
                <li>Forward secrecy partielle (cl√© unique par session)</li>
            </ul>

            <h3>2.3 D√©rivation de cl√© (KDF)</h3>
            <p>Pour les sessions prot√©g√©es par mot de passe :</p>
            <div class="code-block">
Algorithm: PBKDF2-SHA256<br>
Iterations: 310,000 (OWASP recommendation 2023)<br>
Salt: 128 bits random<br>
Output: 256 bits AES key
            </div>

            <h3>2.4 Int√©grit√© des fichiers</h3>
            <p>Chaque fichier transf√©r√© est v√©rifi√© avec :</p>
            <ul>
                <li><strong>SHA-256 hash</strong> calcul√© c√¥t√© √©metteur</li>
                <li>Hash envoy√© avec les m√©tadonn√©es (chiffr√©)</li>
                <li>V√©rification automatique c√¥t√© r√©cepteur apr√®s reconstruction</li>
                <li>Ic√¥ne ‚úÖ "Int√©grit√© v√©rifi√©e" affich√©e si le hash correspond</li>
            </ul>
        </div>

        <!-- LOGS & DONN√âES -->
        <div class="security-section">
            <h2>3. Ce qui est loggu√© (et ce qui ne l'est pas)</h2>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Composant</th>
                            <th>Donn√©e</th>
                            <th>Statut</th>
                            <th>R√©tention</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Nginx</td>
                            <td>Access logs (IP, User-Agent, URL)</td>
                            <td>‚ùå D√âSACTIV√â</td>
                            <td>N/A</td>
                        </tr>
                        <tr>
                            <td>Nginx</td>
                            <td>Error logs</td>
                            <td>‚ùå REDIRIG√â vers /dev/null</td>
                            <td>N/A</td>
                        </tr>
                        <tr>
                            <td>Node.js</td>
                            <td>Console logs (debug)</td>
                            <td>‚ö†Ô∏è STDOUT (systemd journal)</td>
                            <td>Purg√© toutes les heures</td>
                        </tr>
                        <tr>
                            <td>Node.js</td>
                            <td>Room ID, pseudos</td>
                            <td>‚úÖ EN M√âMOIRE</td>
                            <td>Supprim√© √† la fin de session</td>
                        </tr>
                        <tr>
                            <td>coturn</td>
                            <td>Connexions TURN</td>
                            <td>‚ùå D√âSACTIV√â (no-log)</td>
                            <td>N/A</td>
                        </tr>
                        <tr>
                            <td>Base de donn√©es</td>
                            <td>Tout</td>
                            <td>‚ùå PAS DE BDD</td>
                            <td>N/A</td>
                        </tr>
                        <tr>
                            <td>Fichiers transf√©r√©s</td>
                            <td>Contenu, m√©tadonn√©es</td>
                            <td>‚ùå JAMAIS SUR SERVEUR</td>
                            <td>N/A (P2P direct)</td>
                        </tr>
                        <tr>
                            <td>Messages chat</td>
                            <td>Contenu</td>
                            <td>‚ùå JAMAIS SUR SERVEUR</td>
                            <td>N/A (P2P direct)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>3.1 Purge automatique des logs</h3>
            <p>Un script cron s'ex√©cute toutes les heures (<code>/usr/local/bin/purge_logs.sh</code>) pour :</p>
            <ul>
                <li>Purger le journal systemd : <code>journalctl --vacuum-time=3d</code></li>
                <li>Vider les logs SSH : <code>/var/log/auth.log</code></li>
                <li>Anonymiser les IPs r√©siduelles (dernier octet ‚Üí .xxx)</li>
            </ul>

            <h3>3.2 Donn√©es en m√©moire (RAM)</h3>
            <p>Le serveur Node.js conserve temporairement :</p>
            <div class="code-block">
{<br>
&nbsp;&nbsp;"roomId": "a3f5e8c2d1b4f9e7",<br>
&nbsp;&nbsp;"participants": [<br>
&nbsp;&nbsp;&nbsp;&nbsp;{"odId": "random123", "pseudo": "Alice"},<br>
&nbsp;&nbsp;&nbsp;&nbsp;{"odId": "random456", "pseudo": "Bob"}<br>
&nbsp;&nbsp;],<br>
&nbsp;&nbsp;"mode": "both",<br>
&nbsp;&nbsp;"createdAt": 1704297600000<br>
}
            </div>
            <p><strong>Suppression :</strong> D√®s que tous les participants se d√©connectent, ou apr√®s 24h maximum (timeout).</p>
        </div>

        <!-- HEADERS S√âCURIT√â -->
        <div class="security-section">
            <h2>4. Headers de s√©curit√© HTTP</h2>
            <div class="code-block">
Strict-Transport-Security: max-age=63072000; includeSubDomains; preload<br>
Content-Security-Policy: default-src 'self'; script-src 'self'; ...<br>
X-Frame-Options: DENY<br>
X-Content-Type-Options: nosniff<br>
Referrer-Policy: no-referrer<br>
Permissions-Policy: geolocation=(), microphone=(), camera=()
            </div>
            <p><strong>Explications :</strong></p>
            <ul>
                <li><strong>HSTS preload</strong> : Force HTTPS m√™me si l'utilisateur tape http:// (inclus dans la liste de pr√©chargement des navigateurs)</li>
                <li><strong>CSP strict</strong> : Bloque tout script externe, inline JS, et ressources non auto-h√©berg√©es</li>
                <li><strong>X-Frame-Options</strong> : Emp√™che le clickjacking (interdiction d'iframe)</li>
                <li><strong>Permissions-Policy</strong> : D√©sactive l'acc√®s √† la g√©olocalisation, micro, cam√©ra (pas utilis√©s)</li>
            </ul>
        </div>

        <!-- SERVEUR SSH -->
        <div class="security-section">
            <h2>5. S√©curit√© du serveur (infrastructure)</h2>
            
            <h3>5.1 Acc√®s SSH</h3>
            <ul>
                <li>Authentification par cl√© ED25519 uniquement (pas de mot de passe)</li>
                <li>MFA (Google Authenticator) obligatoire pour IPs non-whitelist√©es</li>
                <li>fail2ban actif : 5 tentatives max, ban 1h</li>
                <li>Port 22 expos√© (standard, mais prot√©g√© par MFA)</li>
            </ul>

            <h3>5.2 Mises √† jour automatiques</h3>
            <div class="code-block">
unattended-upgrades: ENABLED<br>
Auto-reboot: 03:00 if kernel update<br>
Security patches: Installed within 24h
            </div>

            <h3>5.3 Firewall</h3>
            <p>Ports ouverts (ufw) :</p>
            <ul>
                <li>22/tcp : SSH (prot√©g√© par fail2ban + MFA)</li>
                <li>80/tcp : HTTP ‚Üí redirect to HTTPS</li>
                <li>443/tcp : HTTPS (Nginx)</li>
                <li>3478/udp, 3478/tcp : STUN (coturn)</li>
                <li>5349/tcp : TURNS over TLS (coturn)</li>
                <li>49152-65535/udp : Plage TURN relay</li>
            </ul>
        </div>

        <!-- MOD√àLE DE MENACES -->
        <div class="security-section">
            <h2>6. Mod√®le de menaces</h2>
            
            <h3>6.1 Contre quoi SecurePeer prot√®ge</h3>
            <div class="info-box">
                <strong>‚úÖ PROT√àGE :</strong>
                <ul>
                    <li>Interception des donn√©es en transit (Man-in-the-Middle) ‚Üí TLS + E2EE</li>
                    <li>Acc√®s aux fichiers/messages par l'op√©rateur du serveur ‚Üí Chiffrement E2E</li>
                    <li>Compromission du serveur ‚Üí Pas de donn√©es stock√©es</li>
                    <li>Demandes l√©gales de donn√©es ‚Üí Rien √† fournir (no-log)</li>
                    <li>Tracking analytics ‚Üí Pas de trackers tiers</li>
                </ul>
            </div>

            <h3>6.2 Limites et menaces r√©siduelles</h3>
            <div class="info-box warning">
                <strong>‚ö†Ô∏è LIMITES :</strong>
                <ul>
                    <li><strong>Adresse IP visible par les autres participants</strong> (nature du P2P WebRTC)<br>
                    ‚Üí <em>Mitigation : Utiliser Tor Browser ou VPN</em></li>
                    <li><strong>M√©tadonn√©es de timing</strong> (heure de connexion, dur√©e de session)<br>
                    ‚Üí <em>Mitigation : Logs purg√©s toutes les heures</em></li>
                    <li><strong>Attaques au niveau navigateur</strong> (malware, keylogger, XSS)<br>
                    ‚Üí <em>Mitigation : CSP strict, pas de scripts inline</em></li>
                    <li><strong>Pas de Forward Secrecy parfaite</strong> (ratchet pas encore impl√©ment√©)<br>
                    ‚Üí <em>Roadmap : Double Ratchet pr√©vu en Phase 2</em></li>
                    <li><strong>Corr√©lation temporelle</strong> (analyste passif peut voir connexions simultan√©es)<br>
                    ‚Üí <em>Mitigation : Utiliser Tor + delays al√©atoires</em></li>
                </ul>
            </div>

            <h3>6.3 Adversaires hors scope</h3>
            <div class="info-box danger">
                <strong>‚ùå NE PROT√àGE PAS CONTRE :</strong>
                <ul>
                    <li>Malware c√¥t√© client (trojan, RAT, spyware)</li>
                    <li>Compromission physique de l'appareil</li>
                    <li>Attaques quantiques (algorithmes post-quantum pas encore int√©gr√©s)</li>
                    <li>Adversaires globaux passifs (NSA-level surveillance de tout Internet)</li>
                    <li>Backdoors mat√©rielles (Intel ME, IME)</li>
                </ul>
            </div>
        </div>

        <!-- AUDITS -->
        <div class="security-section">
            <h2>7. Audits et transparence</h2>
            
            <h3>7.1 Code open-source</h3>
            <p>Le code source de SecurePeer sera publi√© sur GitHub sous licence MIT :</p>
            <ul>
                <li>Frontend : HTML/CSS/JavaScript vanilla</li>
                <li>Backend : Node.js + Express + ws</li>
                <li>Infrastructure : Scripts Ansible pour r√©plication</li>
            </ul>

            <h3>7.2 Audit de s√©curit√©</h3>
            <p><strong>Statut :</strong> Pas encore audit√© par un tiers ind√©pendant.</p>
            <p><strong>Roadmap :</strong> Audit pr√©vu en Q2 2026 par un cabinet sp√©cialis√© (Trail of Bits, Cure53, ou similaire).</p>
            <p><strong>Bug bounty :</strong> Programme de prime aux bugs √† venir (responsable disclosure).</p>

            <h3>7.3 Rapport de transparence</h3>
            <p>Publi√© trimestriellement sur GitHub :</p>
            <ul>
                <li>Nombre de demandes l√©gales re√ßues (actuellement : 0)</li>
                <li>Incidents de s√©curit√© (actuellement : aucun)</li>
                <li>Dur√©e moyenne de uptime</li>
                <li>Mise √† jour du canari de s√©curit√©</li>
            </ul>
        </div>

        <!-- AM√âLIORATIONS FUTURES -->
        <div class="security-section">
            <h2>8. Feuille de route s√©curit√© (2026)</h2>
            
            <h3>Phase 2 : Cryptographie avanc√©e</h3>
            <ul>
                <li>‚úÖ ECDH (Curve25519) - <em>IMPL√âMENT√â</em></li>
                <li>‚è≥ Symmetric Ratchet (HKDF chain) pour forward secrecy</li>
                <li>‚è≥ Double Ratchet (Signal Protocol) pour Perfect Forward Secrecy</li>
                <li>‚è≥ Post-Quantum Crypto (CRYSTALS-Kyber) pour r√©sistance quantique</li>
            </ul>

            <h3>Phase 3 : Anonymat r√©seau</h3>
            <ul>
                <li>‚è≥ Mode TURN-only (forcer relay pour masquer IP)</li>
                <li>‚è≥ Support .onion (Tor Hidden Service)</li>
                <li>‚è≥ I2P support</li>
            </ul>

            <h3>Phase 4 : R√©silience</h3>
            <ul>
                <li>‚è≥ Multi-serveurs (load balancing + failover)</li>
                <li>‚è≥ Support f√©d√©ration (plusieurs instances SecurePeer)</li>
                <li>‚è≥ Mode offline-first (PWA + synchronisation diff√©r√©e)</li>
            </ul>
        </div>

        <!-- RECOMMANDATIONS -->
        <div class="security-section">
            <h2>9. Recommandations d'utilisation</h2>
            
            <h3>Pour utilisateurs standard</h3>
            <ul>
                <li>Utiliser des mots de passe forts pour les sessions sensibles</li>
                <li>Fermer manuellement les sessions apr√®s utilisation</li>
                <li>V√©rifier le cadenas vert (HTTPS) dans la barre d'adresse</li>
                <li>Ne jamais partager le lien sur des canaux publics</li>
            </ul>

            <h3>Pour militants/journalistes/dissidents</h3>
            <ul>
                <li>üßÖ OBLIGATOIRE : Utiliser Tor Browser</li>
                <li>üîê Activer la protection par mot de passe</li>
                <li>‚è±Ô∏è Limiter la dur√©e de session (15 min max)</li>
                <li>üîí Activer "Verrouillage automatique" apr√®s 1er participant</li>
                <li>üíª Utiliser Tails OS ou Whonix pour isolation maximale</li>
                <li>üö´ √âviter de partager le lien via email/SMS (canaux surveillables)</li>
                <li>üì± Privil√©gier Signal/Session pour transmettre le lien</li>
            </ul>

            <h3>Pour d√©veloppeurs</h3>
            <ul>
                <li>V√©rifier les headers de s√©curit√© : <code>curl -I https://securepeer.eu</code></li>
                <li>Inspecter le code source : F12 ‚Üí Sources</li>
                <li>Tester la CSP : Tentative de chargement de script externe</li>
                <li>Signaler les bugs : security@securepeer.eu (GPG disponible)</li>
            </ul>
        </div>

        <!-- CONTACT -->
        <div class="security-section">
            <h2>10. Contact s√©curit√©</h2>
            <p>Pour signaler une vuln√©rabilit√© ou poser une question :</p>
            <ul>
                <li>üìß Email : <strong>security@securepeer.eu</strong></li>
                <li>üîë GPG : <code>0x1234ABCD5678EF90</code> (fingerprint complet sur /pgp)</li>
                <li>üêô GitHub Security Advisory : <a href="https://github.com/securepeer/issues" target="_blank" rel="noopener noreferrer">github.com/securepeer/issues</a></li>
            </ul>
            <p><strong>Responsible Disclosure :</strong> Nous nous engageons √† r√©pondre sous 48h et publier un correctif sous 7 jours pour les vuln√©rabilit√©s critiques.</p>
        </div>

        <a href="/" class="back-link">‚Üê Retour √† l'accueil</a>
    </div>

    <footer class="page-footer">
        <p>üîê SecurePeer - S√©curit√© par design, transparence par d√©faut</p>
        <p class="footer-links">
            <a href="privacy.html">Confidentialit√©</a> | 
            <a href="security.html">S√©curit√©</a>
        </p>
    </footer>

    <script src="app.js"></script>
</body>
</html>
